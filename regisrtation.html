<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>job-connect</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom styles for the app container */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #071739; /* Deep blue from palette */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            /* Fix Screen Layout: Prevent all horizontal scrolling */
            overflow-x: hidden;
        }
        .page-view {
            max-width: 90%;
            width: 100%;
            margin: 3rem auto;
            /* The main page container uses a slightly lighter blue for contrast */
            background-color: #A4B5C4; 
            min-height: 50vh;
            border-radius: 1rem;
            padding: 1rem;
        }
        /* Custom spinner for better visual feedback */
        .loading-spinner {
            border-top-color: transparent !important;
            border-right-color: transparent !important;
            animation: spin 0.6s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Message Box Styling */
        .alert-box {
            position: fixed;
            top: 1rem;
            right: 1rem;
            max-width: 90%;
            z-index: 1000;
        }
    </style>
</head>
<body>

    <!-- Loading Overlay -->
    <div id="loading-view" class="fixed inset-0 bg-[#071739] flex items-center justify-center z-50">
        <div class="flex flex-col items-center">
            <div class="loading-spinner w-12 h-12 border-4 rounded-full border-white mb-4"></div>
            <p class="text-white text-lg">Loading JobConnect...</p>
        </div>
    </div>

    <!-- Navigation Bar -->
    <header class="bg-[#4B6382] shadow-lg">
        <div class="max-w-7xl mx-auto flex justify-between items-center p-4">
            <a href="home.html" class="text-2xl font-bold flex items-center text-white">
                <i data-lucide="rocket" class="w-6 h-6 mr-2 text-[#E3C39D]"></i>
                JobConnect
            </a>
            <button id="nav-auth-button" onclick="window.location.hash='login'" class="bg-[#071739] text-white py-2 px-4 rounded-lg font-semibold hover:bg-opacity-90 transition duration-150">
                Login
            </button>
        </div>
    </header>

    <!-- Main Content Area - Single Page App Simulation -->
    <main id="app-content" class="flex-grow flex items-start justify-center p-4 sm:p-8">
        
        <!-- Dynamic Page View Container (Login, Register, Dashboard) -->
        <div id="page-container" class="page-view shadow-2xl">
            <!-- Content will be injected here -->
        </div>

    </main>

    <script>
        // --- MOCK STATE MANAGEMENT ---
        let currentUser = null;
        let currentUserRole = null;
        
        // --- UTILITY FUNCTIONS ---

        /**
         * Generic message box handler (replaces alert/confirm)
         * @param {string} message 
         * @param {('green'|'red')} type 
         */
        function showMessage(type, message) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert-box p-4 rounded-lg shadow-xl flex items-center ${type === 'green' ? 'bg-green-100 border-l-4 border-green-500 text-green-700' : 'bg-red-100 border-l-4 border-red-500 text-red-700'}`;
            alertDiv.innerHTML = `
                <div class="flex items-center">
                    <i data-lucide="${type === 'green' ? 'check-circle' : 'alert-triangle'}" class="w-5 h-5 mr-3"></i>
                    <p class="font-medium text-sm">${message}</p>
                </div>
            `;
            document.body.appendChild(alertDiv);
            lucide.createIcons();

            setTimeout(() => {
                // Use opacity transition for smooth removal
                alertDiv.classList.add('opacity-0', 'transition', 'duration-500');
                setTimeout(() => alertDiv.remove(), 500);
            }, 5000);
        }

        /**
         * Manages the loading state of authentication buttons.
         * @param {boolean} isLoading 
         * @param {string} originalText 
         */
        function setAuthLoading(isLoading, originalText) {
            const button = document.getElementById('auth-button');
            if (!button) return;

            button.disabled = isLoading;
            if (isLoading) {
                button.innerHTML = `
                    <div class="loading-spinner w-5 h-5 border-2 rounded-full border-white border-b-transparent animate-spin mr-2"></div>
                    Processing...
                `;
                button.classList.add('bg-opacity-70', 'cursor-not-allowed');
            } else {
                button.innerHTML = originalText;
                button.classList.remove('bg-opacity-70', 'cursor-not-allowed');
            }
        }
        
        // --- PAGE RENDERING ---

        /**
         * Renders the authentication form (login or register).
         * @param {('login'|'register')} type 
         */
        function renderAuthForm(type) {
            const isRegister = type === 'register';
            const pageContainer = document.getElementById('page-container');
            const title = isRegister ? 'Create Your JobConnect Account' : 'Log In to Your Portal';
            const buttonText = isRegister ? 'Register Account' : 'Secure Login';
            const otherText = isRegister ? 'Already have an account?' : 'Need an account?';
            const otherLink = isRegister ? '#login' : '#register';
            const otherLinkText = isRegister ? 'Log In' : 'Register Here';

            pageContainer.innerHTML = `
                <div class="max-w-md mx-auto p-4 sm:p-8 bg-white rounded-lg shadow-xl mt-4 border-t-8 border-[#071739]">
                    <h2 class="text-3xl font-bold text-center text-[#071739] mb-6">${title}</h2>

                    <form id="auth-form" class="space-y-4">
                        <div class="space-y-2">
                            <label for="email" class="text-sm font-medium text-gray-700">Email Address</label>
                            <input type="email" id="email" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-[#071739] focus:border-[#071739]" placeholder="you@company.com">
                        </div>

                        <div class="space-y-2">
                            <label for="password" class="text-sm font-medium text-gray-700">Password</label>
                            <input type="password" id="password" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-[#071739] focus:border-[#071739]" placeholder="Min 8 characters">
                        </div>
                        
                        ${isRegister ? `
                            <div class="space-y-2">
                                <label for="role" class="text-sm font-medium text-gray-700">I am a...</label>
                                <select id="role" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-[#071739] focus:border-[#071739]">
                                    <option value="">Select Role</option>
                                    <option value="employee">Employee (Finding Jobs)</option>
                                    <option value="employer">Employer (Hiring Talent)</option>
                                </select>
                            </div>
                        ` : ''}

                        <button type="submit" id="auth-button" class="bg-[#E3C39D] text-[#071739] font-bold py-3 px-6 rounded-lg w-full text-lg hover:bg-opacity-90 transition duration-150 flex items-center justify-center mt-6">
                            ${buttonText}
                        </button>
                    </form>

                    <div class="text-center mt-4">
                        <p class="text-sm text-gray-600">${otherText} <a href="${otherLink}" class="text-[#4B6382] hover:text-[#071739] font-semibold">${otherLinkText}</a></p>
                    </div>
                </div>
            `;
            
            // Attach event listener to the form
            document.getElementById('auth-form').addEventListener('submit', (e) => handleAuthSubmit(e, type, buttonText));
            lucide.createIcons();
        }

        /**
         * Renders a simple dashboard view after successful login/registration.
         */
        function showUserDashboard() {
            const pageContainer = document.getElementById('page-container');
            const dashboardLink = currentUserRole === 'employee' ? 'employee.html' : 'employer.html';
            const portalName = currentUserRole === 'employee' ? 'Employee Portal' : 'Employer Console';

            pageContainer.innerHTML = `
                <div class="max-w-md mx-auto p-8 bg-white rounded-lg shadow-xl mt-4 border-t-8 border-green-500 text-center">
                    <i data-lucide="check-circle" class="w-16 h-16 text-green-500 mx-auto mb-4"></i>
                    <h2 class="text-3xl font-bold text-[#071739] mb-3">Welcome, User!</h2>
                    <p class="text-gray-700 mb-6">You are successfully logged in as an **${currentUserRole}**.</p>
                    
                    <a href="${dashboardLink}" class="bg-green-600 text-white font-bold py-3 px-6 rounded-lg w-full text-lg hover:bg-green-700 transition duration-150 inline-flex items-center justify-center">
                        <i data-lucide="${currentUserRole === 'employee' ? 'briefcase' : 'monitor-dot'}" class="w-5 h-5 mr-2"></i>
                        Go to ${portalName} &rarr;
                    </a>

                    <button onclick="window.logout()" class="mt-4 text-sm text-red-500 hover:text-red-700 font-medium">Log Out</button>
                </div>
            `;
            lucide.createIcons();
        }

        // --- AUTHENTICATION LOGIC (MOCK) ---

        /**
         * Handles the form submission for both login and register.
         * @param {Event} e 
         * @param {('login'|'register')} type 
         * @param {string} buttonText 
         */
        async function handleAuthSubmit(e, type, buttonText) {
            e.preventDefault();
            setAuthLoading(true, buttonText);
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const role = type === 'register' ? document.getElementById('role').value : 'employee'; // Default to employee for login mock

            // Simple validation
            if (password.length < 8) {
                showMessage('red', 'Password must be at least 8 characters long.');
                setAuthLoading(false, buttonText);
                return;
            }

            try {
                // Simulate Network Delay
                await new Promise(resolve => setTimeout(resolve, 1500));

                // Mock Authentication Success
                currentUser = email;
                currentUserRole = role;

                if (type === 'login') {
                    showMessage('green', 'Login successful! Redirecting to your dashboard...');
                } else {
                    showMessage('green', 'Registration successful! Setting up your account...');
                }
                
                // Final state update and navigation after successful auth
                updateNavigation();
                showUserDashboard();
                
            } catch (error) {
                console.error("Authentication Error:", error);
                showMessage('red', `Authentication Failed: ${error.message}`);
            } finally {
                setAuthLoading(false, buttonText);
            }
        }
        
        /**
         * Handles user logout.
         */
        window.logout = async () => {
             // Simulate Network Delay
            await new Promise(resolve => setTimeout(resolve, 300));

            currentUser = null;
            currentUserRole = null;
            console.log("User signed out.");

            updateNavigation();
            showPage('login'); // Redirect to login page
        };

        /**
         * Updates the navigation bar based on the user's logged-in status.
         */
        function updateNavigation() {
            const authButton = document.getElementById('nav-auth-button');
            if (currentUser) {
                // User is logged in (simulated)
                authButton.textContent = 'Log Out';
                authButton.onclick = window.logout;
                authButton.classList.remove('bg-[#071739]');
                authButton.classList.add('bg-red-500', 'hover:bg-red-600');
            } else {
                // User is logged out
                authButton.textContent = 'Login';
                authButton.onclick = () => window.location.hash = 'login';
                authButton.classList.add('bg-[#071739]');
                authButton.classList.remove('bg-red-500', 'hover:bg-red-600');
            }
        }

        /**
         * Router function to show the correct page.
         * @param {string} hash - The current URL hash (e.g., 'login', 'register').
         */
        function showPage(hash) {
            const type = hash === 'register' ? 'register' : 'login';
            renderAuthForm(type);
        }

        /**
         * Initializes the application state on load.
         */
        function initializeApp() {
            // Hide the initial loading overlay
            document.getElementById('loading-view').classList.add('hidden');
            
            // Determine initial page view from hash
            const hash = window.location.hash.substring(1) || 'login';
            showPage(hash);
            
            // Update navigation based on current (logged-out) state
            updateNavigation();
        }
        
        // Event listener for hash changes
        window.addEventListener('hashchange', () => {
            const hash = window.location.hash.substring(1);
            showPage(hash);
        });

        // Start the application setup
        window.onload = initializeApp;

    </script>
</body>
</html>
